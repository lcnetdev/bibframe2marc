<?xml version='1.0'?>
<rules xmlns="http://www.loc.gov/bf2marc"
       xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
       xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
       xmlns:bf="http://id.loc.gov/ontologies/bibframe/"
       xmlns:bflc="http://id.loc.gov/ontologies/bflc/"
       xmlns:madsrdf="http://www.loc.gov/mads/rdf/v1#"
       xmlns:marc="http://www.loc.gov/MARC21/slim"
       xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <cf tag="001">
    <transform><xsl:value-of select="$vRecordId"/></transform>
  </cf>

  <cf tag="003">
    <switch>
      <case test="$pConversionAgency != 'DLC' and $pRecordId != ''">
        <transform><xsl:value-of select="$pConversionAgency"/></transform>
      </case>
      <case test="default">
        <switch>
          <case test="$vAdminMetadata/bf:identifiedBy/*[local-name()='Local' or rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/Local']/bf:assigner/*/*[local-name()='code']">
            <transform>
              <xsl:value-of select="$vAdminMetadata/bf:identifiedBy/*[local-name()='Local' or rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/Local']/bf:assigner/*/*[local-name()='code']"/>
            </transform>
          </case>
          <case test="default"><transform><xsl:value-of select="$pConversionAgency"/></transform></case>
        </switch>
      </case>
    </switch>
  </cf>

  <switch>
    <case test="$vAdminMetadata/bf:changeDate">
      <switch>
        <case test="$vAdminMetadata/bf:changeDate/@rdf:datatype='http://www.w3.org/2001/XMLSchema#dateTime'">
          <cf tag="005">
            <transform>
              <xsl:value-of select="concat(substring($vAdminMetadata/bf:changeDate,1,4),substring($vAdminMetadata/bf:changeDate,6,2),substring($vAdminMetadata/bf:changeDate,9,2),substring($vAdminMetadata/bf:changeDate,12,2),substring($vAdminMetadata/bf:changeDate,15,2),substring($vAdminMetadata/bf:changeDate,18,2),'.0')"/>
            </transform>
          </cf>
        </case>
        <case test="$vAdminMetadata/bf:changeDate/@rdf:datatype='http://www.w3.org/2001/XMLSchema#date'">
          <cf tag="005">
            <transform>
              <xsl:value-of select="concat(substring($vAdminMetadata/bf:changeDate,1,4),substring($vAdminMetadata/bf:changeDate,6,2),substring($vAdminMetadata/bf:changeDate,9,2),'000000.0')"/>
            </transform>
          </cf>
        </case>
        <!-- attempt to convert an un-typed value that appears to be xsd:dateTime -->
        <case test="string-length($vAdminMetadata/bf:changeDate) &gt;= 19 and
                    substring($vAdminMetadata/bf:changeDate,5,1) = '-' and
                    substring($vAdminMetadata/bf:changeDate,8,1) = '-' and
                    substring($vAdminMetadata/bf:changeDate,11,1) = 'T' and
                    substring($vAdminMetadata/bf:changeDate,14,1) = ':' and
                    substring($vAdminMetadata/bf:changeDate,17,1) = ':'">
          <cf tag="005">
            <transform>
              <xsl:value-of select="concat(substring($vAdminMetadata/bf:changeDate,1,4),substring($vAdminMetadata/bf:changeDate,6,2),substring($vAdminMetadata/bf:changeDate,9,2),substring($vAdminMetadata/bf:changeDate,12,2),substring($vAdminMetadata/bf:changeDate,15,2),substring($vAdminMetadata/bf:changeDate,18,2),'.0')"/>
            </transform>
          </cf>
        </case>
        <!-- attempt to convert an un-typed value that appears to be xsd:date -->
        <case test="string-length($vAdminMetadata/bf:changeDate) &gt;= 10 and
                    substring($vAdminMetadata/bf:changeDate,5,1) = '-' and
                    substring($vAdminMetadata/bf:changeDate,8,1) = '-'">
          <cf tag="005">
            <transform>
              <xsl:value-of select="concat(substring($vAdminMetadata/bf:changeDate,1,4),substring($vAdminMetadata/bf:changeDate,6,2),substring($vAdminMetadata/bf:changeDate,9,2),'000000.0')"/>
            </transform>
          </cf>
        </case>
        <!-- pass through something that appears to be ISO 8601 with no punctuation -->
        <!-- this will miss non-ASCII alpha characters -->
        <case test="string-length($vAdminMetadata/bf:changeDate) &gt;= 14 and
                    translate($vAdminMetadata/bf:changeDate,'-:.abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ','') = $vAdminMetadata/bf:changeDate">
          <cf tag="005">
            <transform>
              <xsl:value-of select="concat(substring($vAdminMetadata/bf:changeDate,1,14),'.0')"/>
            </transform>
          </cf>
        </case>
        <case test="string-length($vAdminMetadata/bf:changeDate) &gt;= 8 and
                    translate($vAdminMetadata/bf:changeDate,'-:.abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ','') = $vAdminMetadata/bf:changeDate">
          <cf tag="005">
            <transform>
              <xsl:value-of select="concat(substring($vAdminMetadata/bf:changeDate,1,8),'000000.0')"/>
            </transform>
          </cf>
        </case>
        <case test="default">
          <transform>
            <xsl:message>Record <xsl:value-of select="$vRecordId"/>: Unprocessed bf:changeDate. Invalid datatype for 005.</xsl:message>
          </transform>
        </case>
      </switch>
    </case>
  </switch>

  
  <cf tag="007" repeatable="true">
    <context xpath="/rdf:RDF/bf:Instance">
      <switch>
        
        <!-- Map 007 -->
        <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026058' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026058' or
          bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026061' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026061' or
          bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026387' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026387' or
          bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026113' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026113' or
          bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017027245' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017027245' or
          bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026530' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026530' or
          bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026295' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026295' or
          bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2018026045' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2018026045'">
          <context xpath="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026058' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026058' or
            bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026061' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026061' or
            bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026387' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026387' or
            bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026113' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026113' or
            bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017027245' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017027245' or
            bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026530' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026530' or
            bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026295' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026295' or
            bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2018026045' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2018026045'">
            <fixed-field>
              <!-- 00-02 -->
              <position default="a| ">
                <switch>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026058' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026058'"><text>ad </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026061' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026061'"><text>ag </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026387' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026387'"><text>aj </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026113' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026113'"><text>ak </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017027245' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017027245'"><text>aq </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026530' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026530'"><text>ar </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026295' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026295'"><text>as </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2018026045' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2018026045'"><text>ay </text></case>
                </switch>
              </position>
              <!-- 03-07 -->
              <position default="|||||"/>
            </fixed-field>
          </context>
        </case>
        
        
        <!-- Globe -->
        <case test="(bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/n' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/n') and
          (bf:carrier/@rdf:resource='http://id.loc.gov/vocabulary/carriers/nr' or bf:carrier/*/@rdf:about='http://id.loc.gov/vocabulary/carriers/nr') and 
          (
          (bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026300' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026300') or 
          (bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026117' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026117')
          )">
          <context xpath="(bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/n' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/n') and
            (bf:carrier/@rdf:resource='http://id.loc.gov/vocabulary/carriers/nr' or bf:carrier/*/@rdf:about='http://id.loc.gov/vocabulary/carriers/nr') and 
            (
            (bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026300' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026300') or 
            (bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026117' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026117')
            )">
            <fixed-field>
              <!-- 00-05 -->
              <position default="d| |||">
                <switch>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026117' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026117'"><text>da |||</text></case>
                </switch>
              </position>
            </fixed-field>
          </context>
        </case>
        
        <!-- Projected graphic 007 -->
        <case test="(bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/g' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/g') and
                    (
                      (
                        bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/gc'] or
                        bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/gd'] or
                        bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/gf'] or
                        bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/mo'] or
                        bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/gs'] or
                        bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/gt']
                      )
                    or
                      (
                        ../*[local-name()='StillImage'] or ../bf:Work/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/StillImage'
                      ) 
                    )">
          <context xpath="(bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/g' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/g') and
                          (
                            (
                              bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/gc'] or
                              bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/gd'] or
                              bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/gf'] or
                              bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/mo'] or
                              bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/gs'] or
                              bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/gt']
                            )
                          or
                          (
                            ../*[local-name()='StillImage'] or ../bf:Work/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/StillImage'
                            ) 
                         )">
            <fixed-field>
              <!-- 00-02 -->
              <position default="g| ">
                <switch>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/gc' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/gc']"><text>gc </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/gd' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/gd']"><text>gd </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/gf' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/gf']"><text>gf </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/mo' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/mo']"><text>go </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/gs' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/gs']"><text>gs </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/gt' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/gt']"><text>gt </text></case>
                </switch>
              </position>
              <!-- 03-08 -->
              <position default="||||||"/>
            </fixed-field>
          </context>
        </case>
        
        
        <!-- Microform 007 -->
        <case test="bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/h' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/h'">
          <context xpath="bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/h' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/h'">
            <fixed-field>
              <!-- 00-02 -->
              <position default="h| ">
                <switch>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/ha' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/ha']"><text>ha </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/hb' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/hb']"><text>hb </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/hc' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/hc']"><text>hc </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/hd' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/hd']"><text>hd </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/he' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/he']"><text>he </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/hf' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/hf']"><text>hf </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/hg' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/hg']"><text>hg </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/hh' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/hh']"><text>hh </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/hj' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/hj']"><text>hj </text></case>
                </switch>
              </position>
              <!-- 03-12 -->
              <position default="||||||||||"/>
            </fixed-field>
          </context>
        </case>
        
        
        <!-- Nonprojected graphic -->
        <case test="(bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/n' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/n') and
                    (
                      (
                        bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2017027227'] or 
                        bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2017027231'] or 
                        bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2017027246'] or 
                        bf:genreForm//@rdf:*[.='http://id.loc.gov/vocabulary/graphicMaterials/tgm007730'] or 
                        bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2019026026'] or 
                        bf:genreForm//@rdf:*[.='http://id.loc.gov/vocabulary/graphicMaterials/tgm007718'] or 
                        bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2017027251'] or 
                        bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2017027255'] or 
                        bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2014026152'] or 
                        bf:genreForm//@rdf:*[.='http://id.loc.gov/vocabulary/graphicMaterials/tgm009250'] or 
                        bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2016026011'] or 
                        bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2014026151'] or 
                        bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2017027249']
                      )
                    or
                      (
                        ../*[local-name()='StillImage'] or ../bf:Work/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/StillImage'
                      )
                    )">
          <context xpath="(bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/n' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/n') and
                          (
                            (
                              bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2017027227'] or 
                              bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2017027231'] or 
                              bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2017027246'] or 
                              bf:genreForm//@rdf:*[.='http://id.loc.gov/vocabulary/graphicMaterials/tgm007730'] or 
                              bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2019026026'] or 
                              bf:genreForm//@rdf:*[.='http://id.loc.gov/vocabulary/graphicMaterials/tgm007718'] or 
                              bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2017027251'] or 
                              bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2017027255'] or 
                              bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2014026152'] or 
                              bf:genreForm//@rdf:*[.='http://id.loc.gov/vocabulary/graphicMaterials/tgm009250'] or 
                              bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2016026011'] or 
                              bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2014026151'] or 
                              bf:genreForm//@rdf:*[.='http://id.loc.gov/authorities/genreForms/gf2017027249']
                            )
                          or
                            (
                              ../*[local-name()='StillImage'] or ../bf:Work/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/StillImage'
                            )
                          )">
            <fixed-field>
              <!-- 00-02 -->
              <position default="k| ">
                <switch>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017027227' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017027227'"><text>kc </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017027231' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017027231'"><text>kd </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017027246' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017027246'"><text>ke </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/vocabulary/graphicMaterials/tgm007730' or bf:genreForm/*/@rdf:about='http://id.loc.gov/vocabulary/graphicMaterials/tgm007730'"><text>kf </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2019026026' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2019026026'"><text>kg </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/vocabulary/graphicMaterials/tgm007718' or bf:genreForm/*/@rdf:about='http://id.loc.gov/vocabulary/graphicMaterials/tgm007718'"><text>kh </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017027251' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017027251'"><text>ki </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017027255' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017027255'"><text>kj </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026152' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026152'"><text>kk </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/vocabulary/graphicMaterials/tgm009250' or bf:genreForm/*/@rdf:about='http://id.loc.gov/vocabulary/graphicMaterials/tgm009250'"><text>kl </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2016026011' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2016026011'"><text>kn </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026151' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026151'"><text>kp </text></case>
                  <case test="bf:genreForm/@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017027249' or bf:genreForm/*/@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017027249'"><text>kv </text></case>
                </switch>
              </position>
              <!-- 03-05 -->
              <position default="|||"/>
            </fixed-field>
          </context>
        </case>
        
        
        <!-- Motion picture 007 -->
        <case test="(bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/g' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/g') and
                    (
                      (
                        bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/mc'] or
                        bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/mf'] or
                        bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/mr'] or
                        bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/mz']
                      )
                    or
                      (
                        ../*[local-name()='MovingImage'] or ../bf:Work/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/MovingImage'
                      ) 
                    )">
          <context xpath="(bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/g' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/g') and
                          (
                            (
                              bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/mc'] or
                              bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/mf'] or
                              bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/mr'] or
                              bf:carrier//@rdf:*[.='http://id.loc.gov/vocabulary/carriers/mz']
                            )
                          or
                            (
                              ../*[local-name()='MovingImage'] or ../bf:Work/rdf:type/@rdf:resource='http://id.loc.gov/ontologies/bibframe/MovingImage'
                            ) 
                          )">
            <fixed-field>
              <!-- 00-02 -->
              <position default="m| ">
                <switch>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/mc' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/mc']"><text>mc </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/mf' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/mf']"><text>mf </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/mr' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/mr']"><text>mr </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/mz' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/mz']"><text>mz </text></case>
                </switch>
              </position>
              <!-- 03-22 -->
              <position default="||||||||||||||||||||"/>
            </fixed-field>
          </context>
        </case>
        
        <!-- Sound recording 007 -->
        <case test="bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/s' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/s'">
          <context xpath="bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/s' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/s'">
            <fixed-field>
              <!-- 00-02 -->
              <position default="s| ">
                <switch>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/sd' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/sd']"><text>sd </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/se' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/se']"><text>se </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/sg' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/sg']"><text>sg </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/si' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/si']"><text>si </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/sq' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/sq']"><text>sq </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/cr' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/cr']"><text>sr </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/ss' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/ss']"><text>ss </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/st' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/st']"><text>st </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/sw' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/sw']"><text>sw </text></case>
                </switch>
              </position>
              <!-- 03-13 -->
              <position default="|||||||||||"/>
            </fixed-field>
          </context>
        </case>
        
        
        <!-- Video recording 007 -->
        <case test="bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/v' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/v'">
          <context xpath="bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/v' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/v'">
            <fixed-field>
              <!-- 00-02 -->
              <position default="v| ">
                <switch>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/vc' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/vc']"><text>vc </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/vd' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/vd']"><text>vd </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/vf' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/vf']"><text>vf </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/vr' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/vr']"><text>vr </text></case>
                </switch>
              </position>
              <!-- 03-08 -->
              <position default="||||||"/>
            </fixed-field>
          </context>
        </case>
        
        
        <!-- Text 007 -->
        <case test="(not(bf:media/@rdf:resource) and not(bf:media/*/@rdf:about)) or 
          (bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/n' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/n')
          ">
          <text>t|</text>
        </case>

        
        <!-- Electronic resource 007 - moved this to end so they are always last. -->
        <case test="bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/c' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/c'">
          <context xpath="bf:media/@rdf:resource='http://id.loc.gov/vocabulary/mediaTypes/c' or bf:media/*/@rdf:about='http://id.loc.gov/vocabulary/mediaTypes/c'">
            <fixed-field>
              <!-- 00-02 -->
              <position default="c| ">
                <switch>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/ca' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/ca']"><text>ca </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/cb' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/cb']"><text>cb </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/cd' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/cd']"><text>co </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/ce' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/ce']"><text>cj </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/cf' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/cf']"><text>cf </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/ch' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/ch']"><text>ch </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/ck' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/ck']"><text>ck </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/cr' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/cr']"><text>cr </text></case>
                  <case test="bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/cz' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/cz']"><text>cz </text></case>
                </switch>
              </position>
              <!-- 03-13 -->
              <position default="|||||||||||"/>
            </fixed-field>
          </context>
        </case>
      </switch>
    </context>
  </cf>


  <cf tag="008">
    <context xpath="/rdf:RDF">
      <var name="v008Format">
        <switch>
          <case test="bf:Work/rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Cartography']">MP</case>
          <case test="bf:Instance/bf:issuance/bf:Issuance[@rdf:about='http://id.loc.gov/vocabulary/issuance/serl'] or
                      bf:Instance/bf:issuance[@rdf:resource='http://id.loc.gov/vocabulary/issuance/serl'] or
                      bf:Instance/bf:issuance/bf:Issuance[@rdf:about='http://id.loc.gov/vocabulary/issuance/intg'] or
                      bf:Instance/bf:issuance[@rdf:resource='http://id.loc.gov/vocabulary/issuance/intg']">CR</case>
          <case test="bf:Work/rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Audio'] or
                      bf:Work/rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/NotatedMusic']">MU</case>
          <case test="bf:Work/rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MovingImage'] or
                      bf:Work/rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/StillImage'] or
                      bf:Work/rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Object']">VM</case>
          <case test="bf:Work/rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MixedMaterial']">MX</case>
          <case test="bf:Instance/rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/Electronic']">CF</case>
          <case test="default">BK</case>
        </switch>
      </var>
      <!-- because 24-29 are different for music, need to define this variable here -->
      <var name="vMUSupplContent">
        <transform>
          <xsl:variable name="vMUSupplRaw">
            <xsl:for-each select="bf:Work/bf:supplementaryContent">
              <xsl:choose>
                <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/discography' or */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/discography'">a</xsl:when>
                <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/bibliography' or */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/bibliography'">b</xsl:when>
                <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/thematicindex' or */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/thematicindex'">c</xsl:when>
                <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/libretto' or */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/libretto'">d</xsl:when>
                <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/creatorbio' or */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/creatorbio'">e</xsl:when>
                <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/performerhistory' or */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/performerhistory'">f</xsl:when>
                <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/techinstruments' or */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/techinstruments'">g</xsl:when>
                <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/techmusic' or */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/techmusic'">h</xsl:when>
                <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/historicalinfo' or */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/historicalinfo'">i</xsl:when>
                <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/ethnologicinfo' or */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/ethnologicinfo'">k</xsl:when>
                <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/instructmaterial' or */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/instructmaterial'">r</xsl:when>
                <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/music' or */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/music'">s</xsl:when>
              </xsl:choose>
            </xsl:for-each>
          </xsl:variable>
          <xsl:variable name="vMUSupplPadded">
            <xsl:call-template name="tPadRight">
              <xsl:with-param name="pInput" select="$vMUSupplRaw"/>
              <xsl:with-param name="pStringLength">6</xsl:with-param>
            </xsl:call-template>
          </xsl:variable>
          <xsl:choose>
            <xsl:when test="string-length($vMUSupplPadded) &gt; 6">
              <xsl:value-of select="substring($vMUSupplPadded,1,6)"/>
            </xsl:when>
            <xsl:otherwise><xsl:value-of select="$vMUSupplPadded"/></xsl:otherwise>
          </xsl:choose>
        </transform>
      </var>

      <fixed-field>
        <!-- 00-05 -->
        <position default="700101">
          <switch>
            <case test="$vAdminMetadata/bf:creationDate">
              <select xpath="$vAdminMetadata/bf:creationDate">
                <switch>
                  <case test="@rdf:datatype='http://www.w3.org/2001/XMLSchema#dateTime' or @rdf:datatype='http://www.w3.org/2001/XMLSchema#date' or @rdf:datatype='http://id.loc.gov/datatypes/edtf'">
                    <transform><xsl:value-of select="translate(substring(.,3,8),'-','')"/></transform>
                  </case>
                  <case test="default">
                    <transform>
                      <xsl:message>Record <xsl:value-of select="$vRecordId"/>: Unprocessed bf:creationDate. Invalid datatype.</xsl:message>
                    </transform>
                  </case>
                </switch>
              </select>
            </case>
            <case test="$pGenerationDatestamp != ''">
              <transform><xsl:value-of select="translate(substring($pGenerationDatestamp,3,8),'-','')"/></transform>
            </case>
          </switch>
        </position>

        <!-- 06-14 -->
        <position default="|||||||||">
          <!-- there could easily be multiple provisionActivity properties, so there will be warnings -->
          <!-- some date types are difficult to build from BIBFRAME, so keep this simple for now -->
          <switch>
            <!-- Distribution and Production - 'p' -->
            <case test="
                  (
                    bf:Instance/bf:provisionActivity/bf:ProvisionActivity[rdf:type/@rdf:resource = 'http://id.loc.gov/ontologies/bibframe/Distribution']/bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf' and
                    bf:Instance/bf:provisionActivity/bf:ProvisionActivity[rdf:type/@rdf:resource = 'http://id.loc.gov/ontologies/bibframe/Production']/bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf'
                  ) or (
                    bf:Instance/bf:provisionActivity/bf:Distribution/bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf' and
                    bf:Instance/bf:provisionActivity/bf:Production/bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf'                
                  )
                ">
              <transform>
                <xsl:variable name="date1">
                  <xsl:choose>
                    <xsl:when test="bf:Instance/bf:provisionActivity/bf:Distribution/bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf'">
                      <xsl:value-of select="bf:Instance/bf:provisionActivity/bf:Distribution/bf:date[@rdf:datatype = 'http://id.loc.gov/datatypes/edtf']" />
                    </xsl:when>
                    <xsl:otherwise>
                      <xsl:value-of select="bf:Instance/bf:provisionActivity/bf:ProvisionActivity[rdf:type/@rdf:resource = 'http://id.loc.gov/ontologies/bibframe/Distribution']/bf:date[@rdf:datatype = 'http://id.loc.gov/datatypes/edtf']" />    
                    </xsl:otherwise>
                  </xsl:choose>
                </xsl:variable>
                <xsl:variable name="date2">
                  <xsl:choose>
                    <xsl:when test="bf:Instance/bf:provisionActivity/bf:Production/bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf'">
                      <xsl:value-of select="bf:Instance/bf:provisionActivity/bf:Production/bf:date[@rdf:datatype = 'http://id.loc.gov/datatypes/edtf']" />                      
                    </xsl:when>
                    <xsl:otherwise>
                      <xsl:value-of select="bf:Instance/bf:provisionActivity/bf:ProvisionActivity[rdf:type/@rdf:resource = 'http://id.loc.gov/ontologies/bibframe/Production']/bf:date[@rdf:datatype = 'http://id.loc.gov/datatypes/edtf']" />    
                    </xsl:otherwise>
                  </xsl:choose>
                </xsl:variable>
                <xsl:value-of select="translate(concat('p', $date1, $date2), 'X', 'u')"></xsl:value-of>
              </transform>
            </case>
            
            <case test="
              bf:Instance/bf:provisionActivity/bf:ProvisionActivity[rdf:type/@rdf:resource = 'http://id.loc.gov/ontologies/bibframe/Production']/bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf' 
              or 
              bf:Instance/bf:provisionActivity/bf:Production/bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf'
              ">
              <transform>
                <xsl:variable name="vPAprenodeset">
                  <xsl:choose>
                    <xsl:when test="bf:Instance/bf:provisionActivity/bf:Production/bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf'">
                      <xsl:copy-of select="bf:Instance/bf:provisionActivity/bf:Production[bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf']" />
                    </xsl:when>
                    <xsl:otherwise>
                      <xsl:copy-of select="bf:Instance/bf:provisionActivity/bf:ProvisionActivity[rdf:type/@rdf:resource = 'http://id.loc.gov/ontologies/bibframe/Production' and bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf']" />    
                    </xsl:otherwise>
                  </xsl:choose>                  
                </xsl:variable>
                <xsl:variable name="vPA" select="exsl:node-set($vPAprenodeset)" />
                <xsl:variable name="date1">
                  <xsl:value-of select="$vPA/bf:*/bf:date[@rdf:datatype = 'http://id.loc.gov/datatypes/edtf']" />
                </xsl:variable>
                <xsl:choose>
                  <xsl:when test="$vPA/bf:*/bf:note/bf:Note/rdfs:label = 'inclusive collection dates'">
                    <xsl:value-of select="translate(concat('i', translate($date1, '/', '')), 'X', 'u')"></xsl:value-of>
                  </xsl:when>
                  <xsl:when test="$vPA/bf:*/bf:note/bf:Note/rdfs:label = 'bulk collection dates'">
                    <xsl:value-of select="translate(concat('k', translate($date1, '/', '')), 'X', 'u')"></xsl:value-of>
                  </xsl:when>
                </xsl:choose>
              </transform>
            </case>
            
            <!-- Publication resource/event has EDTF date. -->
            <case test="
              bf:Instance/bf:provisionActivity/bf:ProvisionActivity[rdf:type/@rdf:resource = 'http://id.loc.gov/ontologies/bibframe/Publication']/bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf'
              or
              bf:Instance/bf:provisionActivity/bf:Publication/bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf'
              ">
              <transform>
                <xsl:variable name="vPAprenodeset">
                  <xsl:choose>
                    <xsl:when test="bf:Instance/bf:provisionActivity/bf:Publication/bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf'">
                      <xsl:copy-of select="bf:Instance/bf:provisionActivity/bf:Publication[bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf']" />
                    </xsl:when>
                    <xsl:otherwise>
                      <xsl:copy-of select="bf:Instance/bf:provisionActivity/bf:ProvisionActivity[rdf:type/@rdf:resource = 'http://id.loc.gov/ontologies/bibframe/Publication' and bf:date/@rdf:datatype = 'http://id.loc.gov/datatypes/edtf']" />    
                    </xsl:otherwise>
                  </xsl:choose>
                </xsl:variable>
                <xsl:variable name="vPA" select="exsl:node-set($vPAprenodeset)" />
                <xsl:variable name="theDate">
                  <xsl:value-of select="$vPA/bf:*/bf:date[@rdf:datatype = 'http://id.loc.gov/datatypes/edtf']" />
                </xsl:variable>
                <xsl:variable name="date1">
                  <xsl:choose>
                    <xsl:when test="string-length($theDate)=4">
                      <xsl:value-of select="substring($theDate, 1, 4)" />
                    </xsl:when>
                    <xsl:when test="contains($theDate ,'/')">
                      <xsl:value-of select="substring-before($theDate, '/')" />
                    </xsl:when>
                    <xsl:when test="contains($theDate ,'-')">
                      <xsl:value-of select="substring-before($theDate, '-')" />
                    </xsl:when>
                  </xsl:choose>
                </xsl:variable>
                <xsl:variable name="cDateExists">
                  <xsl:choose>
                    <xsl:when test="bf:Instance/bf:copyrightDate[@rdf:datatype = 'http://id.loc.gov/datatypes/edtf']">1</xsl:when>
                    <xsl:otherwise>0</xsl:otherwise>
                  </xsl:choose>
                </xsl:variable>
                <xsl:variable name="date2">
                  <xsl:choose>
                    <xsl:when test="$cDateExists = 1">
                      <xsl:value-of select="translate(bf:Instance/bf:copyrightDate[@rdf:datatype = 'http://id.loc.gov/datatypes/edtf'], 'Â©', '')" />
                    </xsl:when>
                    <xsl:when test="contains($theDate, '/..')">9999</xsl:when>
                    <xsl:when test="contains($theDate, '/')">
                      <xsl:value-of select="substring-after($theDate,'/')" />
                    </xsl:when>
                    <xsl:when test="contains($theDate, '-')">
                      <xsl:value-of select="substring-after($theDate,'-')" />
                    </xsl:when>
                  </xsl:choose>
                </xsl:variable>
                <xsl:choose>
                  <xsl:when test="string-length($date1) = 4 and $cDateExists = 1">
                    <xsl:value-of select="translate(concat('t', $date1, $date2), 'X', 'u')" />
                  </xsl:when>
                  <xsl:when test="$vPA/bf:*/bf:status/bf:Status/@rdf:about = 'http://id.loc.gov/vocabulary/mstatus/current' and
                    string-length($date1) = 4 and string-length($date2) = 4">
                    <xsl:value-of select="translate(concat('c', $date1, $date2), 'X', 'u')" />
                  </xsl:when>
                  <xsl:when test="$vPA/bf:*/bf:status/bf:Status/@rdf:about = 'http://id.loc.gov/vocabulary/mstatus/ceased' and
                                  string-length($date1) = 4 and string-length($date2) = 4">
                    <xsl:value-of select="translate(concat('d', $date1, $date2), 'X', 'u')" />
                  </xsl:when>
                  <xsl:when test="string-length($date1)=4 and string-length($date2)=5 and 
                                  (contains($date2, '~') or contains($date2, '?') or contains($date2, '%'))">
                    <xsl:value-of select="translate(concat('q', $date1, $date2), 'X', 'u')" />
                  </xsl:when>
                  <xsl:when test="string-length($date1)=4 and string-length($date2)=4">
                    <xsl:value-of select="translate(concat('m', $date1, $date2), 'X', 'u')" />
                  </xsl:when>
                  <xsl:when test="$date2 != ''">
                    <xsl:choose>
                      <xsl:when test="contains($date2, '-')">
                        <xsl:value-of select="translate(concat('e', $date1, translate($date2, '-', '')), 'X', 'u')" />
                      </xsl:when>
                      <xsl:otherwise>
                        <xsl:value-of select="translate(concat('e', $date1, $date2, '  '), 'X', 'u')" />
                      </xsl:otherwise>
                    </xsl:choose>
                  </xsl:when>
                  <xsl:when test="string-length($date1) = 4">
                    <xsl:value-of select="translate(concat('s', $date1, '||||'), 'X', 'u')" />
                  </xsl:when>
                </xsl:choose>
              </transform>
            </case>
          </switch>

        </position>

        <!-- 15-17 -->
        <position default="xx ">
          <!-- there could easily be multiple provisionActivity properties, so there will be warnings -->
          <select xpath="bf:Instance/bf:provisionActivity/bf:*/bf:place/@rdf:resource|
                         bf:Instance/bf:provisionActivity/bf:*/bf:place/bf:*/@rdf:about">
            <switch>
              <case test="starts-with(.,'http://id.loc.gov/vocabulary/countries/')">
                <transform>
                  <xsl:variable name="vCode">
                    <xsl:value-of select="substring-after(.,'http://id.loc.gov/vocabulary/countries/')"/>
                  </xsl:variable>
                  <xsl:choose>
                    <xsl:when test="string-length($vCode)=3"><xsl:value-of select="$vCode"/></xsl:when>
                    <xsl:when test="string-length($vCode)=2">
                      <xsl:value-of select="concat($vCode,' ')"/>
                    </xsl:when>
                  </xsl:choose>
                </transform>
              </case>
            </switch>
          </select>
        </position>

        <!-- 18-21 -->
        <position default="    ">
            <!-- Useful for debugging. -->
            <!--
            <transform>
                <xsl:message>Format is</xsl:message>
                <xsl:message><xsl:value-of select="$v008Format" /></xsl:message>
            </transform>
            -->
          <switch>
            <case test="$v008Format='BK'">
              <transform>
                <xsl:variable name="vIllus">
                  <xsl:for-each select="*/bf:illustrativeContent">
                    <xsl:choose>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/ill' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/ill' or
                                      */*[local-name()='code']='ill'">a</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/map' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/map' or
                                      */*[local-name()='code']='map'">b</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/por' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/por' or
                                      */*[local-name()='code']='por'">c</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/chr' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/chr' or
                                      */*[local-name()='code']='chr'">d</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/pln' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/pln' or
                                      */*[local-name()='code']='pln'">e</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/plt' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/plt' or
                                      */*[local-name()='code']='plt'">f</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/mus' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/mus' or
                                      */*[local-name()='code']='mus'">g</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/fac' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/fac' or
                                      */*[local-name()='code']='fac'">h</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/coa' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/coa' or
                                      */*[local-name()='code']='coa'">i</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/gnt' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/gnt' or
                                      */*[local-name()='code']='gnt'">j</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/for' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/for' or
                                      */*[local-name()='code']='for'">k</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/sam' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/sam' or
                                      */*[local-name()='code']='sam'">l</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/pho' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/pho' or
                                      */*[local-name()='code']='pho'">m</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/pht' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/pht' or
                                      */*[local-name()='code']='pht'">o</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/millus/ilm' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/millus/ilm' or
                                      */*[local-name()='code']='ilm'">p</xsl:when>
                    </xsl:choose>
                  </xsl:for-each>
                </xsl:variable>
                <xsl:variable name="vIllusPadded">
                  <xsl:call-template name="tPadRight">
                    <xsl:with-param name="pInput" select="$vIllus"/>
                    <!-- useful for testing. -->
                    <!-- <xsl:with-param name="pPadChar" select="'f'"/> -->
                    <xsl:with-param name="pStringLength">4</xsl:with-param>
                  </xsl:call-template>
                </xsl:variable>
                <xsl:choose>
                  <xsl:when test="string-length($vIllusPadded) &gt; 4">
                    <xsl:value-of select="substring($vIllusPadded,1,4)"/>
                  </xsl:when>
                  <xsl:otherwise><xsl:value-of select="$vIllusPadded"/></xsl:otherwise>
                </xsl:choose>
              </transform>
            </case>
            <case test="$v008Format='CR'">
              <transform>
                <xsl:variable name="vFrequency">
                  <xsl:choose>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/ann' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/ann' or */*[local-name()='code']='ann']">a</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/bmn' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/bmn' or */*[local-name()='code']='bmn']">b</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/swk' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/swk' or */*[local-name()='code']='swk']">c</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/dyl' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/dyl' or */*[local-name()='code']='dyl']">d</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/bwk' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/bwk' or */*[local-name()='code']='bwk']">e</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/san' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/san' or */*[local-name()='code']='san']">f</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/bin' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/bin' or */*[local-name()='code']='bin']">g</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/ten' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/ten' or */*[local-name()='code']='ten']">h</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/ttw' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/ttw' or */*[local-name()='code']='ttw']">i</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/ttm' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/ttm' or */*[local-name()='code']='ttm']">j</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/con' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/con' or */*[local-name()='code']='con']">k</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/mon' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/mon' or */*[local-name()='code']='mon']">m</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/qrt' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/qrt' or */*[local-name()='code']='qrt']">q</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/smn' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/smn' or */*[local-name()='code']='smn']">s</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/tty' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/tty' or */*[local-name()='code']='tty']">t</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/unk' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/unk' or */*[local-name()='code']='unk']">u</xsl:when>
                    <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/wkl' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/wkl' or */*[local-name()='code']='wkl']">w</xsl:when>
                    <xsl:otherwise><xsl:value-of select="' '" /></xsl:otherwise>
                  </xsl:choose>
                </xsl:variable>
                <xsl:value-of select="$vFrequency" />
                <xsl:variable name="vRegularity">
                  <xsl:choose>
                    <xsl:when test="$vFrequency != ' '">
                      <xsl:choose>
                        <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/irr' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/irr' or */*/*[local-name()='code']='irr']">n</xsl:when>
                        <xsl:otherwise>r</xsl:otherwise>
                      </xsl:choose>
                    </xsl:when>
                    <xsl:otherwise>
                      <xsl:choose>
                        <xsl:when test="bf:Instance/bf:frequency[@rdf:resource='http://id.loc.gov/vocabulary/frequencies/irr' or */@rdf:about='http://id.loc.gov/vocabulary/frequencies/irr' or */*/*[local-name()='code']='irr']">x</xsl:when>
                        <xsl:otherwise>|</xsl:otherwise>
                      </xsl:choose>
                    </xsl:otherwise>
                  </xsl:choose>
                </xsl:variable>
                <xsl:variable name="vCRType">
                  <xsl:choose>
                    <xsl:when test="bf:Work/bflc:serialPubType[@rdf:resource='http://id.loc.gov/vocabulary/mserialpubtype/database' or */@rdf:about='http://id.loc.gov/vocabulary/mserialpubtype/database' or */*/rdfs:label='database']">d</xsl:when>
                    <xsl:when test="bf:Work/bflc:serialPubType[@rdf:resource='http://id.loc.gov/vocabulary/mserialpubtype/mag' or */@rdf:about='http://id.loc.gov/vocabulary/mserialpubtype/mag' or */*/rdfs:label='mag']">g</xsl:when>
                    <xsl:when test="bf:Work/bflc:serialPubType[@rdf:resource='http://id.loc.gov/vocabulary/mserialpubtype/blog' or */@rdf:about='http://id.loc.gov/vocabulary/mserialpubtype/blog' or */*/rdfs:label='blog']">h</xsl:when>
                    <xsl:when test="bf:Work/bflc:serialPubType[@rdf:resource='http://id.loc.gov/vocabulary/mserialpubtype/journal' or */@rdf:about='http://id.loc.gov/vocabulary/mserialpubtype/journal' or */*/rdfs:label='journal']">j</xsl:when>
                    <xsl:when test="bf:Work/bflc:serialPubType[@rdf:resource='http://id.loc.gov/vocabulary/mserialpubtype/looseleaf' or */@rdf:about='http://id.loc.gov/vocabulary/mserialpubtype/looseleaf' or */*/rdfs:label='looseleaf']">l</xsl:when>
                    <xsl:when test="bf:Work/bflc:serialPubType[@rdf:resource='http://id.loc.gov/vocabulary/mserialpubtype/monoseries' or */@rdf:about='http://id.loc.gov/vocabulary/mserialpubtype/monoseries' or */*/rdfs:label='monoseries']">m</xsl:when>
                    <xsl:when test="bf:Work/bflc:serialPubType[@rdf:resource='http://id.loc.gov/vocabulary/mserialpubtype/newspaper' or */@rdf:about='http://id.loc.gov/vocabulary/mserialpubtype/newspaper' or */*/rdfs:label='newspaper']">n</xsl:when>
                    <xsl:when test="bf:Work/bflc:serialPubType[@rdf:resource='http://id.loc.gov/vocabulary/mserialpubtype/periodical' or */@rdf:about='http://id.loc.gov/vocabulary/mserialpubtype/periodical' or */*/rdfs:label='periodical']">p</xsl:when>
                    <xsl:when test="bf:Work/bflc:serialPubType[@rdf:resource='http://id.loc.gov/vocabulary/mserialpubtype/repo' or */@rdf:about='http://id.loc.gov/vocabulary/mserialpubtype/repo' or */*/rdfs:label='repo']">r</xsl:when>
                    <xsl:when test="bf:Work/bflc:serialPubType[@rdf:resource='http://id.loc.gov/vocabulary/mserialpubtype/newsletter' or */@rdf:about='http://id.loc.gov/vocabulary/mserialpubtype/newsletter' or */*/rdfs:label='newsletter']">s</xsl:when>
                    <xsl:when test="bf:Work/bflc:serialPubType[@rdf:resource='http://id.loc.gov/vocabulary/mserialpubtype/directory' or */@rdf:about='http://id.loc.gov/vocabulary/mserialpubtype/directory' or */*/rdfs:label='directory']">t</xsl:when>
                    <xsl:when test="bf:Work/bflc:serialPubType[@rdf:resource='http://id.loc.gov/vocabulary/mserialpubtype/web' or */@rdf:about='http://id.loc.gov/vocabulary/mserialpubtype/web' or */*/rdfs:label='web']">w</xsl:when>
                    <xsl:otherwise>|</xsl:otherwise>
                  </xsl:choose>
                </xsl:variable>
                <xsl:value-of select="$vRegularity"/>
                <xsl:value-of select="' '"/>
                <xsl:value-of select="$vCRType"/>
              </transform>
            </case>
            <case test="$v008Format='MP'">
              <transform>
                <xsl:variable name="vRelief">
                  <xsl:for-each select="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:relief|bf:Work/bf:cartographicAttributes/bf:Cartographic/bflc:relief">
                    <xsl:choose>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/mrelief/cont' or */@rdf:about='http://id.loc.gov/vocabulary/mrelief/cont'">a</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/mrelief/shad' or */@rdf:about='http://id.loc.gov/vocabulary/mrelief/shad'">b</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/mrelief/grad' or */@rdf:about='http://id.loc.gov/vocabulary/mrelief/grad'">c</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/mrelief/hach' or */@rdf:about='http://id.loc.gov/vocabulary/mrelief/hach'">d</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/mrelief/bath' or */@rdf:about='http://id.loc.gov/vocabulary/mrelief/bath'">e</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/mrelief/form' or */@rdf:about='http://id.loc.gov/vocabulary/mrelief/form'">f</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/mrelief/spot' or */@rdf:about='http://id.loc.gov/vocabulary/mrelief/spot'">g</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/mrelief/pict' or */@rdf:about='http://id.loc.gov/vocabulary/mrelief/pict'">i</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/mrelief/land' or */@rdf:about='http://id.loc.gov/vocabulary/mrelief/land'">j</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/mrelief/isol' or */@rdf:about='http://id.loc.gov/vocabulary/mrelief/isol'">k</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/mrelief/rock' or */@rdf:about='http://id.loc.gov/vocabulary/mrelief/rock'">m</xsl:when>
                    </xsl:choose>
                  </xsl:for-each>
                </xsl:variable>
                <xsl:variable name="vReliefPadded">
                  <xsl:call-template name="tPadRight">
                    <xsl:with-param name="pInput" select="$vRelief"/>
                    <xsl:with-param name="pStringLength">4</xsl:with-param>
                  </xsl:call-template>
                </xsl:variable>
                <xsl:choose>
                  <xsl:when test="string-length($vReliefPadded) &gt; 4">
                    <xsl:value-of select="substring($vReliefPadded,1,4)"/>
                  </xsl:when>
                  <xsl:otherwise><xsl:value-of select="$vReliefPadded"/></xsl:otherwise>
                </xsl:choose>
              </transform>
            </case>
            <case test="$v008Format='MU'">
              <transform>
                <xsl:variable name="vCompForm">
                  <xsl:choose>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026635' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026635']">an</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026648' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026648']">bd</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026664' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026664']">bg</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026665' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026665']">bl</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026650' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026650']">bt</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026701' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026701']">ca</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026707' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026707']">cb</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026724' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026724']">cg</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026713' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026713']">ch</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026712' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026712']">cl</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026687' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026687']">cn</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026725' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026725']">co</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027007' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027007']">cp</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026695' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026695']">cr</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026624' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026624']">cs</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026688' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026688']">ct</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026739' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026739']">cy</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2018026012' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2018026012']">cz</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026753' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026753']">df</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027116' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027116']">dv</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026818' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026818']">fg</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026806' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026806']">fl</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026809' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026809']">fm</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2018026018' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2018026018']">ft</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026839' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026839']">gm</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026872' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026872']">hy</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026879' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026879']">jz</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027050' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027050']">mc</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026915' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026915']">md</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026940' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026940']">mi</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026949' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026949']">mo</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026950' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026950']">mp</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026922' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026922']">mr</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026926' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026926']">ms</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026928' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026928']">mz</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017026144' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017026144']">nc</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026976' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026976']">op</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026980' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026980']">ov</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027017' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027017']">pg</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026861' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026861']">pm</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027005' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027005']">po</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027009' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027009']">pp</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027013' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027013']">pr</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026989' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026989']">ps</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026984' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026984']">pt</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026994' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026994']">pv</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027054' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027054']">rc</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027057' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027057']">rd</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027034' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027034']">rg</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017026128' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017026128']">ri</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027051' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027051']">rp</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027048' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027048']">rq</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027111' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027111']">sd</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027103' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027103']">sg</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027099' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027099']">sn</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027120' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027120']">sp</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027115' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027115']">st</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027116' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027116']">su</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027121' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027121']">sy</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027140' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027140']">tc</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2016026059' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2016026059']">tl</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017026025' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017026025']">vi</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027156' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027156']">vr</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014027167' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014027167']">wz</xsl:when>
                    <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2016026059' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2016026059']">za</xsl:when>
                    <xsl:otherwise>||</xsl:otherwise>
                  </xsl:choose>
                </xsl:variable>
                <xsl:variable name="vMusicForm">
                  <xsl:choose>
                    <xsl:when test="bf:Work/bf:musicFormat[@rdf:resource='http://id.loc.gov/vocabulary/mmusicformat/score' or */@rdf:about='http://id.loc.gov/vocabulary/mmusicformat/score']">a</xsl:when>
                    <xsl:when test="bf:Work/bf:musicFormat[@rdf:resource='http://id.loc.gov/vocabulary/mmusicformat/studyscore' or */@rdf:about='http://id.loc.gov/vocabulary/mmusicformat/studyscore']">b</xsl:when>
                    <xsl:when test="bf:Work/bf:musicFormat[@rdf:resource='http://id.loc.gov/vocabulary/mmusicformat/pianoscore' or */@rdf:about='http://id.loc.gov/vocabulary/mmusicformat/pianoscore']">c</xsl:when>
                    <xsl:when test="bf:Work/bf:musicFormat[@rdf:resource='http://id.loc.gov/vocabulary/mmusicformat/pianopart' or */@rdf:about='http://id.loc.gov/vocabulary/mmusicformat/pianopart']">e</xsl:when>
                    <xsl:when test="bf:Work/bf:musicFormat[@rdf:resource='http://id.loc.gov/vocabulary/mmusicformat/chscore' or */@rdf:about='http://id.loc.gov/vocabulary/mmusicformat/chscore']">h</xsl:when>
                    <xsl:when test="bf:Work/bf:musicFormat[@rdf:resource='http://id.loc.gov/vocabulary/mmusicformat/conscore' or */@rdf:about='http://id.loc.gov/vocabulary/mmusicformat/conscore']">i</xsl:when>
                    <xsl:when test="bf:Work/bf:musicFormat[@rdf:resource='http://id.loc.gov/vocabulary/mmusicformat/perfconpt' or */@rdf:about='http://id.loc.gov/vocabulary/mmusicformat/perfconpt']">j</xsl:when>
                    <xsl:when test="bf:Work/bf:musicFormat[@rdf:resource='http://id.loc.gov/vocabulary/mmusicformat/vocalscore' or */@rdf:about='http://id.loc.gov/vocabulary/mmusicformat/vocalscore']">k</xsl:when>
                    <xsl:otherwise>|</xsl:otherwise>
                  </xsl:choose>
                </xsl:variable>
                <xsl:value-of select="concat($vCompForm,$vMusicForm,'|')"/>
              </transform>
            </case>
            <case test="$v008Format='VM'">
              <switch>
                <case test="bf:Work/rdf:type[@rdf:resource='http://id.loc.gov/ontologies/bibframe/MovingImage']">
                  <transform>
                    <xsl:variable name="vDuration">
                      <xsl:choose>
                        <xsl:when test="bf:Work/bf:duration[@rdf:datatype='http://www.w3.org/2001/XMLSchema#duration']">
                          <xsl:value-of select="substring-before(substring-after(bf:Work/bf:duration[@rdf:datatype='http://www.w3.org/2001/XMLSchema#duration'],'PT'),'M')"/>
                        </xsl:when>
                        <xsl:when test="bf:Work/bf:duration[(. = number(.))]"><xsl:value-of select="bf:Work/bf:duration[(. = number(.))]"/></xsl:when>
                        <xsl:when test="bf:Work/bf:duration[contains(.,'999')]">000</xsl:when>
                        <xsl:otherwise>|||</xsl:otherwise>
                      </xsl:choose>
                    </xsl:variable>
                    <xsl:variable name="vDurationPadded">
                      <xsl:call-template name="tPadLeft">
                        <xsl:with-param name="pInput" select="$vDuration"/>
                        <xsl:with-param name="pStringLength">3</xsl:with-param>
                        <xsl:with-param name="pPadChar">0</xsl:with-param>
                      </xsl:call-template>
                    </xsl:variable>
                    <xsl:variable name="vDurationFinal">
                      <xsl:choose>
                        <xsl:when test="$vDurationPadded &gt; 999">000</xsl:when>
                        <xsl:otherwise><xsl:value-of select="$vDurationPadded"/></xsl:otherwise>
                      </xsl:choose>
                    </xsl:variable>
                    <xsl:value-of select="concat($vDurationFinal,' ')"/>
                  </transform>
                </case>
                <case test="default"><text>nnn </text></case>
              </switch>
            </case>
          </switch>
        </position>

        <!-- 22-23 -->
        <!-- this is convoluted because MP format codes these bytes together, no other format does -->
        <position default="  ">
          <switch>
            <case test="$v008Format='BK' or
                        $v008Format='CF' or
                        $v008Format='MU' or
                        $v008Format='CR' or
                        $v008Format='VM' or
                        $v008Format='MX'">
              <transform>
                <!--<xsl:variable name="v008-22">-->
                  <xsl:choose>
                    <xsl:when test="$v008Format='MX'"><xsl:value-of select="' '"/></xsl:when>
                    <xsl:when test="$v008Format='CR'">
                      <xsl:value-of select="' '"/>
                    </xsl:when>
                      <!--<xsl:choose>
                        <xsl:when test="bf:Instance/bf:note/*[rdf:type/@rdf:resource='http://id.loc.gov/vocabulary/mnotetype/orig']">
                          <xsl:for-each select="bf:Instance/bf:note/*[rdf:type/@rdf:resource='http://id.loc.gov/vocabulary/mnotetype/orig']">
                            <xsl:if test="position()=1">
                              <xsl:choose>
                                <xsl:when test="translate(rdfs:label,$upper,$lower)='microfilm'">a</xsl:when>
                                <xsl:when test="translate(rdfs:label,$upper,$lower)='microfiche'">b</xsl:when>
                                <xsl:when test="translate(rdfs:label,$upper,$lower)='microopaque'">c</xsl:when>
                                <xsl:when test="translate(rdfs:label,$upper,$lower)='large print'">d</xsl:when>
                                <xsl:when test="translate(rdfs:label,$upper,$lower)='newspaper format'">e</xsl:when>
                                <xsl:when test="translate(rdfs:label,$upper,$lower)='braille'">f</xsl:when>
                                <xsl:when test="translate(rdfs:label,$upper,$lower)='online'">o</xsl:when>
                                <xsl:when test="translate(rdfs:label,$upper,$lower)='direct electronic'">q</xsl:when>
                                <xsl:when test="translate(rdfs:label,$upper,$lower)='electronic'">s</xsl:when>
                                <xsl:otherwise><xsl:value-of select="'|'"/></xsl:otherwise>
                              </xsl:choose>
                            </xsl:if>
                          </xsl:for-each>
                        </xsl:when>
                        <xsl:otherwise>
                          <xsl:value-of select="' '"/>
                        </xsl:otherwise>
                      </xsl:choose>
                    -->
                    <xsl:when test="bf:Work/bf:intendedAudience[@rdf:resource='http://id.loc.gov/vocabulary/maudience/pre' or
                                    */@rdf:about='http://id.loc.gov/vocabulary/maudience/pre'
                                    or */*[local-name='code']='pre']">a</xsl:when>
                    <xsl:when test="bf:Work/bf:intendedAudience[@rdf:resource='http://id.loc.gov/vocabulary/maudience/pri' or
                                    */@rdf:about='http://id.loc.gov/vocabulary/maudience/pri'
                                    or */*[local-name='code']='pri']">b</xsl:when>
                    <xsl:when test="bf:Work/bf:intendedAudience[@rdf:resource='http://id.loc.gov/vocabulary/maudience/pad'
                                    or */@rdf:about='http://id.loc.gov/vocabulary/maudience/pad'
                                    or */*[local-name='code']='pad']">c</xsl:when>
                    <xsl:when test="bf:Work/bf:intendedAudience[@rdf:resource='http://id.loc.gov/vocabulary/maudience/ado'
                                    or */@rdf:about='http://id.loc.gov/vocabulary/maudience/ado'
                                    or */*[local-name='code']='ado']">d</xsl:when>
                    <xsl:when test="bf:Work/bf:intendedAudience[@rdf:resource='http://id.loc.gov/vocabulary/maudience/adu'
                                    or */@rdf:about='http://id.loc.gov/vocabulary/maudience/adu'
                                    or */*[local-name='code']='adu']">e</xsl:when>
                    <xsl:when test="bf:Work/bf:intendedAudience[@rdf:resource='http://id.loc.gov/vocabulary/maudience/spe'
                                    or */@rdf:about='http://id.loc.gov/vocabulary/maudience/spe'
                                    or */*[local-name='code']='spe']">f</xsl:when>
                    <xsl:when test="bf:Work/bf:intendedAudience[@rdf:resource='http://id.loc.gov/vocabulary/maudience/gen'
                                    or */@rdf:about='http://id.loc.gov/vocabulary/maudience/gen'
                                    or */*[local-name='code']='gen']">g</xsl:when>
                    <xsl:when test="bf:Work/bf:intendedAudience[@rdf:resource='http://id.loc.gov/vocabulary/maudience/juv'
                                    or */@rdf:about='http://id.loc.gov/vocabulary/maudience/juv'
                                    or */*[local-name='code']='juv']">j</xsl:when>
                    <xsl:otherwise><xsl:value-of select="' '"/></xsl:otherwise>
                  </xsl:choose>
                <!--</xsl:variable>-->
                <!--<xsl:variable name="v008-23">-->
                  <xsl:choose>
                    <xsl:when test="$v008Format='VM'"><xsl:value-of select="' '"/></xsl:when>
                    <xsl:when test="$v008Format='CF'">
                      <xsl:choose>
                        <xsl:when test="bf:Instance/bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/cr' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/cr' or */*[local-name()='code']='cr']">o</xsl:when>
                        <xsl:when test="bf:Instance/bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/cz' or */@rdf:about='http://id.loc.gov/vocabulary/carriers/cz' or */*[local-name()='code']='cz']">q</xsl:when>
                        <xsl:otherwise><xsl:value-of select="' '"/></xsl:otherwise>
                      </xsl:choose>
                    </xsl:when>
                    <xsl:when test="bf:Instance/bf:fontSize[@rdf:resource='http://id.loc.gov/vocabulary/mfont/lp'] or
                                    bf:Instance/bf:fontSize/*[@rdf:about='http://id.loc.gov/vocabulary/mfont/lp'] or
                                    bf:Instance/bf:fontSize/*[contains(rdfs:label,'large print')]">d</xsl:when>
                    <xsl:when test="bf:Instance/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mtactile/brail'] or
                                    bf:Instance/bf:notation/*[@rdf:about='http://id.loc.gov/vocabulary/mtactile/brail'] or
                                    bf:Instance/bf:notation/*[contains(rdfs:label,'braille')]">f</xsl:when>
                    <xsl:when test="bf:Instance/bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/hd'] or
                                    bf:Instance/bf:carrier/*[@rdf:about='http://id.loc.gov/vocabulary/carriers/hd'] or
                                    bf:Instance/bf:carrier/*/*[local-name()='code']='hd'">a</xsl:when>
                    <xsl:when test="bf:Instance/bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/he'] or
                                    bf:Instance/bf:carrier/*[@rdf:about='http://id.loc.gov/vocabulary/carriers/he'] or
                                    bf:Instance/bf:carrier/*/*[local-name()='code']='he'">b</xsl:when>
                    <xsl:when test="bf:Instance/bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/hg'] or
                                    bf:Instance/bf:carrier/*[@rdf:about='http://id.loc.gov/vocabulary/carriers/hg'] or
                                    bf:Instance/bf:carrier/*/*[local-name()='code']='hg'">c</xsl:when>
                    <xsl:when test="bf:Instance/bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/cr'] or
                                    bf:Instance/bf:carrier/*[@rdf:about='http://id.loc.gov/vocabulary/carriers/cr'] or
                                    bf:Instance/bf:carrier/*/*[local-name()='code']='cr'">o</xsl:when>
                    <xsl:when test="bf:Instance/bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/cz' or 
                                                            */@rdf:about='http://id.loc.gov/vocabulary/carriers/cz' or 
                                                            */*[local-name()='code']='cz']">s</xsl:when>
                    <xsl:otherwise><xsl:value-of select="' '"/></xsl:otherwise>
                  </xsl:choose>
                <!--</xsl:variable>-->
                <!--<xsl:value-of select="concat($v008-22,$v008-23)"/>-->
              </transform>
            </case>
            <case test="$v008Format='MP'">
              <switch>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/aa' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/aa' or */*[local-name()='code']='aa']">aa</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/ab' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/ab' or */*[local-name()='code']='ab']">ab</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/ac' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/ac' or */*[local-name()='code']='ac']">ac</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/ad' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/ad' or */*[local-name()='code']='ad']">ad</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/ae' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/ae' or */*[local-name()='code']='ae']">ae</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/af' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/af' or */*[local-name()='code']='af']">af</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/ag' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/ag' or */*[local-name()='code']='ag']">ag</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/am' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/am' or */*[local-name()='code']='am']">am</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/an' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/an' or */*[local-name()='code']='an']">an</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/ap' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/ap' or */*[local-name()='code']='ap']">ap</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/au' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/au' or */*[local-name()='code']='au']">au</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/az' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/az' or */*[local-name()='code']='az']">az</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/ba' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/ba' or */*[local-name()='code']='ba']">ba</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bb' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bb' or */*[local-name()='code']='bb']">bb</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bc' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bc' or */*[local-name()='code']='bc']">bc</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bd' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bd' or */*[local-name()='code']='bd']">bd</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bf' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bf' or */*[local-name()='code']='bf']">bf</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bg' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bg' or */*[local-name()='code']='bg']">bg</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bh' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bh' or */*[local-name()='code']='bh']">bh</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bi' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bi' or */*[local-name()='code']='bi']">bi</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bj' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bj' or */*[local-name()='code']='bj']">bj</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bk' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bk' or */*[local-name()='code']='bk']">bk</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bl' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bl' or */*[local-name()='code']='bl']">bl</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bo' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bo' or */*[local-name()='code']='bo']">bo</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/br' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/br' or */*[local-name()='code']='br']">br</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bs' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bs' or */*[local-name()='code']='bs']">bs</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bu' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bu' or */*[local-name()='code']='bu']">bu</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/bz' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/bz' or */*[local-name()='code']='bz']">bz</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/ca' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/ca' or */*[local-name()='code']='ca']">ca</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/cb' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/cb' or */*[local-name()='code']='cb']">cb</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/cc' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/cc' or */*[local-name()='code']='cc']">cc</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/ce' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/ce' or */*[local-name()='code']='ce']">ce</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/cp' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/cp' or */*[local-name()='code']='cp']">cp</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/cu' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/cu' or */*[local-name()='code']='cu']">cu</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/cz' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/cz' or */*[local-name()='code']='cz']">cz</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/da' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/da' or */*[local-name()='code']='da']">da</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/db' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/db' or */*[local-name()='code']='db']">db</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/dc' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/dc' or */*[local-name()='code']='dc']">dc</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/dd' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/dd' or */*[local-name()='code']='dd']">dd</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/de' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/de' or */*[local-name()='code']='de']">de</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/df' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/df' or */*[local-name()='code']='df']">df</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/dg' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/dg' or */*[local-name()='code']='dg']">dg</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/dh' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/dh' or */*[local-name()='code']='dh']">dh</case>
                <case test="bf:Work/bf:cartographicAttributes/bf:Cartographic/bf:projection[@rdf:resource='http://id.loc.gov/vocabulary/mprojection/dl' or */@rdf:about='http://id.loc.gov/vocabulary/mprojection/dl' or */*[local-name()='code']='dl']">dl</case>
                <case test="default"><text>  </text></case>
              </switch>
            </case>
          </switch>
        </position>

        <!-- 24-27 -->
        <position default="    ">
          <switch>
            <case test="$v008Format='BK' or
                        $v008Format='CR'">
              <transform>
                <xsl:variable name="vNoC">
                  <!--<xsl:for-each select="bf:Work/bf:genreForm|bf:Work/bf:supplementaryContent">-->
                  <xsl:for-each select="bf:Work/bf:supplementaryContent">
                    <xsl:choose>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/bibliography' or
                        */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/bibliography'">b</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/discography' or
                        */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/discography'">k</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/film' or
                        */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/film'">q</xsl:when>
                      
                      <!--
                        kefo note - match specs for 24-27 for now - 19 Aug 2022 - and so comment out  
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/bibliography' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/bibliography'">a</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026048' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026048'">b</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026057' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026057'">c</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026086' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026086'">d</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026092' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026092'">e</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026109' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026109'">f</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026351' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026351'">g</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026049' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026049'">h</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026112' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026112'">i</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026438' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026438'">j</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/discography' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/discography'">k</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026351' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026351'">l</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026039' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026039'">m</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/msupplcont/film' or
                                      */@rdf:about='http://id.loc.gov/vocabulary/msupplcont/film'">q</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026087' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026087'">r</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026181' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026181'">s</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2015026093' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2015026093'">t</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026208' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026208'">y</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026707' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026707'">z</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026055' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026055'">5</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026266' or
                                      */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026266'">6</xsl:when>
                      -->
                    </xsl:choose>
                  </xsl:for-each>
                </xsl:variable>
                <xsl:variable name="vNoCLength">
                  <xsl:choose>
                    <xsl:when test="$v008Format='BK'">4</xsl:when>
                    <xsl:when test="$v008Format='CR'">3</xsl:when>
                  </xsl:choose>
                </xsl:variable>
                <xsl:variable name="vNoCPadded">
                  <xsl:call-template name="tPadRight">
                    <xsl:with-param name="pInput" select="$vNoC"/>
                    <!-- useful for testing. -->
                    <!-- <xsl:with-param name="pPadChar" select="'x'"/> -->
                    <xsl:with-param name="pStringLength"><xsl:value-of select="$vNoCLength"/></xsl:with-param>
                  </xsl:call-template>
                </xsl:variable>
                <xsl:variable name="vNoCFinal">
                  <xsl:choose>
                    <xsl:when test="string-length($vNoCPadded) &gt; $vNoCLength">
                      <xsl:value-of select="substring($vNoCPadded,1,$vNoCLength)"/>
                    </xsl:when>
                    <xsl:otherwise><xsl:value-of select="$vNoCPadded"/></xsl:otherwise>
                  </xsl:choose>
                </xsl:variable>
                <xsl:choose>
                  <xsl:when test="$v008Format='BK'"><xsl:value-of select="$vNoCFinal"/></xsl:when>
                  <xsl:when test="$v008Format='CR'"><xsl:value-of select="concat(' ',$vNoCFinal)"/></xsl:when>
                </xsl:choose>
              </transform>
            </case>
            <case test="$v008Format='CF'">
              <switch>
                <case test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/num' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/num' or */*[local-name()='code']='num']"><text>  a </text></case>
                <case test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/com' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/com' or */*[local-name()='code']='com']"><text>  b </text></case>
                <case test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/rep' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/rep' or */*[local-name()='code']='rep']"><text>  c </text></case>
                <case test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/doc' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/doc' or */*[local-name()='code']='doc']"><text>  d </text></case>
                <case test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/bda' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/bda' or */*[local-name()='code']='bda']"><text>  e </text></case>
                <case test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/fon' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/fon' or */*[local-name()='code']='fon']"><text>  f </text></case>
                <case test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/gam' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/gam' or */*[local-name()='code']='gam']"><text>  g </text></case>
                <case test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/sou' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/sou' or */*[local-name()='code']='sou']"><text>  h </text></case>
                <case test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/inm' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/inm' or */*[local-name()='code']='inm']"><text>  i </text></case>
                <case test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/ons' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/ons' or */*[local-name()='code']='ons']"><text>  j </text></case>
                <case test="default"><text>  | </text></case>
              </switch>
            </case>
            <case test="$v008Format='MP'"><text> |  </text></case>
            <case test="$v008Format='MU'">
              <transform><xsl:value-of select="substring($vMUSupplContent,1,4)"/></transform>
            </case>
          </switch>
        </position>

        <!-- 28 -->
        <position default=" ">
          <switch>
            <case test="$v008Format='BK' or
                        $v008Format='CF' or
                        $v008Format='MP' or
                        $v008Format='CR' or
                        $v008Format='VM'">
              <select xpath="bf:Work/bflc:governmentPubType">
                <switch>
                  <case test="@rdf:resource='http://id.loc.gov/vocabulary/mgovtpubtype/a' or
                              */@rdf:about='http://id.loc.gov/vocabulary/mgovtpubtype/a' or
                              */*[local-name()='code']='a'">a</case>
                  <case test="@rdf:resource='http://id.loc.gov/vocabulary/mgovtpubtype/c' or
                              */@rdf:about='http://id.loc.gov/vocabulary/mgovtpubtype/c' or
                              */*[local-name()='code']='c'">c</case>
                  <case test="@rdf:resource='http://id.loc.gov/vocabulary/mgovtpubtype/f' or
                              */@rdf:about='http://id.loc.gov/vocabulary/mgovtpubtype/f' or
                              */*[local-name()='code']='f'">f</case>
                  <case test="@rdf:resource='http://id.loc.gov/vocabulary/mgovtpubtype/i' or
                              */@rdf:about='http://id.loc.gov/vocabulary/mgovtpubtype/i' or
                              */*[local-name()='code']='i'">i</case>
                  <case test="@rdf:resource='http://id.loc.gov/vocabulary/mgovtpubtype/l' or
                              */@rdf:about='http://id.loc.gov/vocabulary/mgovtpubtype/l' or
                              */*[local-name()='code']='l'">l</case>
                  <case test="@rdf:resource='http://id.loc.gov/vocabulary/mgovtpubtype/m' or
                              */@rdf:about='http://id.loc.gov/vocabulary/mgovtpubtype/m' or
                              */*[local-name()='code']='m'">m</case>
                  <case test="@rdf:resource='http://id.loc.gov/vocabulary/mgovtpubtype/s' or
                              */@rdf:about='http://id.loc.gov/vocabulary/mgovtpubtype/s' or
                              */*[local-name()='code']='s'">s</case>
                  <case test="default">o</case>
                </switch>
              </select>
            </case>
            <case test="$v008Format='MU'">
              <transform><xsl:value-of select="substring($vMUSupplContent,5,1)"/></transform>
            </case>
          </switch>
        </position>

        <!-- 29 -->
        <position default="|">
          <switch>
            <case test="$v008Format='BK' or
                        $v008Format='CR'">
              <switch>
                <case test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026068' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026068']">1</case>
                <case test="default">0</case>
              </switch>
            </case>
            <case test="$v008Format='MP' or $v008Format='VM'">
              <switch>
                <case test="bf:Instance/bf:fontSize[@rdf:resource='http://id.loc.gov/vocabulary/mfont/lp'] or
                            bf:Instance/bf:fontSize/*[@rdf:about='http://id.loc.gov/vocabulary/mfont/lp'] or
                            bf:Instance/bf:fontSize/*[contains(rdfs:label,'large print')]">d</case>
                <case test="bf:Instance/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mtactile/brail'] or
                            bf:Instance/bf:notation/*[@rdf:about='http://id.loc.gov/vocabulary/mtactile/brail'] or
                            bf:Instance/bf:notation/*[contains(rdfs:label,'braille')]">f</case>
                <case test="bf:Instance/bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/hd'] or
                            bf:Instance/bf:carrier/*[@rdf:about='http://id.loc.gov/vocabulary/carriers/hd'] or
                            bf:Instance/bf:carrier/*/*[local-name()='code']='hd'">a</case>
                <case test="bf:Instance/bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/he'] or
                            bf:Instance/bf:carrier/*[@rdf:about='http://id.loc.gov/vocabulary/carriers/he'] or
                            bf:Instance/bf:carrier/*/*[local-name()='code']='he'">b</case>
                <case test="bf:Instance/bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/hg'] or
                            bf:Instance/bf:carrier/*[@rdf:about='http://id.loc.gov/vocabulary/carriers/hg'] or
                            bf:Instance/bf:carrier/*/*[local-name()='code']='hg'">c</case>
                <case test="bf:Instance/bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/cr'] or
                            bf:Instance/bf:carrier/*[@rdf:about='http://id.loc.gov/vocabulary/carriers/cr'] or
                            bf:Instance/bf:carrier/*/*[local-name()='code']='cr'">o</case>
                <case test="bf:Instance/bf:carrier[@rdf:resource='http://id.loc.gov/vocabulary/carriers/cz' or 
                                                    */@rdf:about='http://id.loc.gov/vocabulary/carriers/cz' or 
                                                    */*[local-name()='code']='cz']">s</case>
                <case test="default"><text> </text></case>
              </switch>
            </case>
            <case test="$v008Format='MU'">
              <transform><xsl:value-of select="substring($vMUSupplContent,6,1)"/></transform>
            </case>
          </switch>
        </position>

        <!-- 30-31 -->
        <!-- this is convoluted because MU format codes these bytes together, others code separately -->
        <position default="||">
          <switch>
            <case test="$v008Format='BK' or
                        $v008Format='MP'">
              <transform>
                <xsl:variable name="v008-30">
                  <xsl:choose>
                    <xsl:when test="$v008Format='BK'">
                      <xsl:choose>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2016026082' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2016026082']">1</xsl:when>
                        <xsl:otherwise>0</xsl:otherwise>
                      </xsl:choose>
                    </xsl:when>
                    <xsl:when test="$v008Format='MP'"><xsl:value-of select="' '"/></xsl:when>
                  </xsl:choose>
                </xsl:variable>
                <xsl:value-of select="$v008-30"/>
                <xsl:variable name="v008-31">
                  <xsl:choose>
                    <xsl:when test="bf:Instance/bf:supplementaryContent/*[contains(rdfs:label,'index')]">1</xsl:when>
                    <xsl:otherwise>|</xsl:otherwise>
                  </xsl:choose>
                </xsl:variable>
                <xsl:value-of select="$v008-31"/>
              </transform>
            </case>
            <case test="$v008Format='MU'">
              <transform>
                <xsl:variable name="vLitText">
                  <xsl:for-each select="bf:Work/bf:genreForm">
                    <xsl:choose>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026047' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026047'">a</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026049' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026049'">b</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026068' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026068'">c</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026297' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026297'">d</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026094' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026094'">e</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026339' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026339'">f</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026113' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026113'">g</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/marcgt/his' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/his'">h</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026114' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026114'">i</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/marcgt/lan' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/lan'">j</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026110' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026110'">k</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026363' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026363'">l</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026047' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026047'">m</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026344' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026344'">o</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026481' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026481'">p</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/vocabulary/marcgt/reh' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/reh'">r</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026594' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026594'">s</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026115' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026115'">t</xsl:when>
                    </xsl:choose>
                  </xsl:for-each>
                </xsl:variable>
                <xsl:variable name="vLitTextPadded">
                  <xsl:call-template name="tPadRight">
                    <xsl:with-param name="pInput" select="$vLitText"/>
                    <xsl:with-param name="pStringLength">2</xsl:with-param>
                  </xsl:call-template>
                </xsl:variable>
                <xsl:choose>
                  <xsl:when test="string-length($vLitTextPadded) &gt; 2">
                    <xsl:value-of select="substring($vLitTextPadded,1,2)"/>
                  </xsl:when>
                  <xsl:otherwise><xsl:value-of select="$vLitTextPadded"/></xsl:otherwise>
                </xsl:choose>
              </transform>
            </case>
            <case test="$v008Format='CR' or $v008Format='VM'">
              <transform>
                <xsl:value-of select="' '"/>
                <xsl:value-of select="' '"/>
              </transform>
            </case>
          </switch>
        </position>

        <!-- 32 -->
        <position default=" "/>

        <!-- 33-34 -->
        <!-- this is convoluted because MP format codes these bytes together, others code separately -->
        <position default="| ">
          <switch>
            <case test="$v008Format='BK' or
                        $v008Format='CR' or
                        $v008Format='VM'">
              <transform>
                <xsl:variable name="v008-33">
                  <xsl:choose>
                    <xsl:when test="$v008Format='BK'">
                      <xsl:choose>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026339' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026339']">1</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026297' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026297']">d</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026094' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026094']">e</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2015026020' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2015026020']">f</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026110' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026110']">h</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026141' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026141']">i</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026542' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026542']">j</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026339' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026339']">m</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026481' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026481']">p</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026363' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026363']">s</xsl:when>
                        <xsl:otherwise>0</xsl:otherwise>
                      </xsl:choose>
                    </xsl:when>
                    <xsl:when test="$v008Format='CR'">
                      <xsl:choose>
                        <xsl:when test="bf:Work/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mscript/a' or */@rdf:about='http://id.loc.gov/vocabulary/mscript/a' or */*[local-name()='code']='a']">a</xsl:when>
                        <xsl:when test="bf:Work/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mscript/b' or */@rdf:about='http://id.loc.gov/vocabulary/mscript/b' or */*[local-name()='code']='b']">b</xsl:when>
                        <xsl:when test="bf:Work/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mscript/c' or */@rdf:about='http://id.loc.gov/vocabulary/mscript/c' or */*[local-name()='code']='c']">c</xsl:when>
                        <xsl:when test="bf:Work/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mscript/d' or */@rdf:about='http://id.loc.gov/vocabulary/mscript/d' or */*[local-name()='code']='d']">d</xsl:when>
                        <xsl:when test="bf:Work/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mscript/e' or */@rdf:about='http://id.loc.gov/vocabulary/mscript/e' or */*[local-name()='code']='e']">e</xsl:when>
                        <xsl:when test="bf:Work/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mscript/f' or */@rdf:about='http://id.loc.gov/vocabulary/mscript/f' or */*[local-name()='code']='f']">f</xsl:when>
                        <xsl:when test="bf:Work/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mscript/g' or */@rdf:about='http://id.loc.gov/vocabulary/mscript/g' or */*[local-name()='code']='g']">g</xsl:when>
                        <xsl:when test="bf:Work/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mscript/h' or */@rdf:about='http://id.loc.gov/vocabulary/mscript/h' or */*[local-name()='code']='h']">h</xsl:when>
                        <xsl:when test="bf:Work/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mscript/i' or */@rdf:about='http://id.loc.gov/vocabulary/mscript/i' or */*[local-name()='code']='i']">i</xsl:when>
                        <xsl:when test="bf:Work/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mscript/j' or */@rdf:about='http://id.loc.gov/vocabulary/mscript/j' or */*[local-name()='code']='j']">j</xsl:when>
                        <xsl:when test="bf:Work/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mscript/k' or */@rdf:about='http://id.loc.gov/vocabulary/mscript/k' or */*[local-name()='code']='k']">k</xsl:when>
                        <xsl:when test="bf:Work/bf:notation[@rdf:resource='http://id.loc.gov/vocabulary/mscript/l' or */@rdf:about='http://id.loc.gov/vocabulary/mscript/l' or */*[local-name()='code']='l']">l</xsl:when>
                        <xsl:otherwise><xsl:value-of select="' '"/></xsl:otherwise>
                      </xsl:choose>
                    </xsl:when>
                    <xsl:when test="$v008Format='VM'">
                      <xsl:choose>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017027218' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017027218']">a</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/kit' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/kit']">b</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/art' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/art']">c</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/dio' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/dio']">d</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/fls' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/fls']">f</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026158' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026158']">g</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017027251' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017027251']">i</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/gra' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/gra']">k</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/ted' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/ted']">l</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026406' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026406']">m</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/cha' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/cha']">n</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/fla' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/fla']">o</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/mic' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/mic']">p</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017027245' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017027245']">q</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/rea' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/rea']">r</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/sli' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/sli']">s</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/tra' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/tra']">t</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026723' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026723']">v</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/vocabulary/marcgt/toy' or */@rdf:about='http://id.loc.gov/vocabulary/marcgt/toy']">w</xsl:when>
                        <xsl:otherwise>|</xsl:otherwise>
                      </xsl:choose>
                    </xsl:when>
                  </xsl:choose>
                </xsl:variable>
                <xsl:value-of select="$v008-33" />
                <xsl:variable name="v008-34">
                  <xsl:choose>
                    <xsl:when test="$v008Format='BK'">
                      <xsl:choose>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026047' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026047']">a</xsl:when>
                        <xsl:when test="bf:Work/bf:genreForm[@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026049' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026049']">d</xsl:when>
                        <xsl:otherwise>|</xsl:otherwise>
                      </xsl:choose>
                    </xsl:when>
                    <xsl:when test="$v008Format='CR'">
                      <xsl:for-each select="$vAdminMetadata/bf:note/*[rdf:type/@rdf:resource='http://id.loc.gov/vocabulary/mnotetype/metaentry']">
                        <xsl:if test="position()=1">
                          <xsl:choose>
                            <xsl:when test="contains(translate(rdfs:label,$upper,$lower),'successive')">0</xsl:when>
                            <xsl:when test="contains(translate(rdfs:label,$upper,$lower),'latest')">1</xsl:when>
                            <xsl:when test="contains(translate(rdfs:label,$upper,$lower),'integrated')">2</xsl:when>
                            <xsl:otherwise>|</xsl:otherwise>
                          </xsl:choose>
                        </xsl:if>
                      </xsl:for-each>
                      <xsl:if test="not($vAdminMetadata/bf:note/*[rdf:type/@rdf:resource='http://id.loc.gov/vocabulary/mnotetype/metaentry'])">|</xsl:if>
                    </xsl:when>
                    <xsl:when test="$v008Format='VM'">
                      <xsl:choose>
                        <xsl:when test="bf:Work/bflc:movingImageTechnique[@rdf:resource='http://id.loc.gov/vocabulary/mtechnique/anim' or */@rdf:about='http://id.loc.gov/vocabulary/mtechnique/anim']">a</xsl:when>
                        <xsl:when test="bf:Work/bflc:movingImageTechnique[@rdf:resource='http://id.loc.gov/vocabulary/mtechnique/animlive' or */@rdf:about='http://id.loc.gov/vocabulary/mtechnique/animlive']">c</xsl:when>
                        <xsl:when test="bf:Work/bflc:movingImageTechnique[@rdf:resource='http://id.loc.gov/vocabulary/mtechnique/live' or */@rdf:about='http://id.loc.gov/vocabulary/mtechnique/live']">l</xsl:when>
                        <xsl:when test="bf:Work/bflc:movingImageTechnique[@rdf:resource='http://id.loc.gov/vocabulary/mtechnique/other' or */@rdf:about='http://id.loc.gov/vocabulary/mtechnique/other']">z</xsl:when>
                        <xsl:otherwise>|</xsl:otherwise>
                      </xsl:choose>
                    </xsl:when>
                  </xsl:choose>
                </xsl:variable>
                <xsl:value-of select="$v008-34" />
              </transform>
            </case>
            <case test="$v008Format='MP'">
              <transform>
                <xsl:variable name="vSpecFormat">
                  <xsl:for-each select="bf:Work/bf:genreForm">
                    <xsl:choose>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026385' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026385'">e</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026151' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026151'">j</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026055' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026055'">k</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2014026158' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2014026158'">l</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026728' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026728'">o</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2017027252' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2017027252'">o</xsl:when>
                      <xsl:when test="@rdf:resource='http://id.loc.gov/authorities/genreForms/gf2011026373' or */@rdf:about='http://id.loc.gov/authorities/genreForms/gf2011026373'">o</xsl:when>
                    </xsl:choose>
                  </xsl:for-each>
                </xsl:variable>
                <xsl:variable name="vSpecFormatPadded">
                  <xsl:call-template name="tPadRight">
                    <xsl:with-param name="pInput" select="$vSpecFormat"/>
                    <xsl:with-param name="pStringLength">2</xsl:with-param>
                  </xsl:call-template>
                </xsl:variable>
                <xsl:choose>
                  <xsl:when test="string-length($vSpecFormatPadded) &gt; 2">
                    <xsl:value-of select="substring($vSpecFormatPadded,1,2)"/>
                  </xsl:when>
                  <xsl:otherwise><xsl:value-of select="$vSpecFormatPadded"/></xsl:otherwise>
                </xsl:choose>
              </transform>
            </case>
          </switch>
        </position>

        <!-- 35-37 -->
        <position default="   ">
          <!-- will need to rely on the first bf:language property, there will likely be warnings -->
          <select xpath="bf:Work/bf:language[@rdf:resource]|bf:Work/bf:language[*/@rdf:about]|bf:Work/bf:language[*/*[local-name()='code']]">
            <switch>
              <case test="*/*[local-name()='code']">
                <switch>
                  <case test="string-length(*/*[local-name()='code']) = 3">
                    <transform><xsl:value-of select="*/*[local-name()='code']"/></transform>
                  </case>
                </switch>
              </case>
              <case test="*[starts-with(@rdf:about,'http://id.loc.gov/vocabulary/languages/')] or starts-with(@rdf:resource,'http://id.loc.gov/vocabulary/languages/')">
                <transform>
                  <xsl:variable name="vCode">
                    <xsl:choose>
                      <xsl:when test="*[starts-with(@rdf:about,'http://id.loc.gov/vocabulary/languages/')]">
                        <xsl:value-of select="substring-after(*/@rdf:about,'http://id.loc.gov/vocabulary/languages/')"/>
                      </xsl:when>
                      <xsl:when test="starts-with(@rdf:resource,'http://id.loc.gov/vocabulary/languages/')">
                        <xsl:value-of select="substring-after(@rdf:resource,'http://id.loc.gov/vocabulary/languages/')"/>
                      </xsl:when>
                    </xsl:choose>
                  </xsl:variable>
                  <xsl:if test="string-length($vCode)=3"><xsl:value-of select="$vCode"/></xsl:if>
                </transform>
              </case>
            </switch>
          </select>
        </position>

        <!-- 38-39 -->
        <position default="  "/>

      </fixed-field>
    </context>
  </cf>

</rules>
